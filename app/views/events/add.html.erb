<script type="text/javascript">
$(function () {
  let dateCnt = <%= @date_cnt %>;
  let inpDateIdx;

  $("#datepicker").datepicker({
    // 日付が選択された時、日付をテキストフィールドへセット
    onSelect: function (dateText, inst) {
      for (inpDateIdx = 1; inpDateIdx <= dateCnt; inpDateIdx++) {
        // 上から検索して空白のところにセット
        if ($("#date_val" + inpDateIdx.toString()).val() == '') {
          $("#date_val" + inpDateIdx.toString()).val(dateText);
          break;
        }
      }
    }
  });

  $(document).on('click', '.rowdel', function () {
    // 同じ行で隣列したinputをクリア
    $(this).parent().prev().children('input').val('');
  });
});
</script>

<% provide(:title, "イベント作成") %>
<h1>Events#add</h1>
<p>Find me in app/views/events/add.html.erb</p>
<% if @event.errors.any? %>
<ul>
  <% @event.errors.full_messages.each do |err| %>
    <li><%= err %></li>
  <% end %>
</ul>
<% end %>
<table>
  <%= form_for(@event, url:{controller:'events', action:'create'}) do |form| %>
    <tr>
      <th>イベント名</th>
      <td><%= form.text_field :title %></td>
    </tr>
    <tr>
      <th>開催日候補</th>
      <td>
        <table><tr>
        <td><div id="datepicker"></div></td>
        <td>
          <table id ="date_list">
            <% @date_cnt.times do |count| %>
              <tr>
                <td><input type="text" id="date_val<%= count + 1 %>" name="date_val[]"></td>
                <td><button type="button" class="rowdel">クリア</button></td>
              </tr>
            <% end %>
          </table>
        </td>
        </tr></table>
      </td>
    </tr>
    <tr>
      <th>URL(お店、イベントページなど)</th>
      <td><%= form.text_field :url %></td>
    </tr>
    <tr>
      <th>会費</th>
      <td><%= form.number_field :fee, min:0, max:99999999, step:1 %></td>
    </tr>
    <tr>
      <th>イベント詳細</th>
      <td><%= form.text_area :detail, {cols:30, rows:3} %></td>
    </tr>
    <tr>
      <th></th>
      <td><%= form.submit "送信" %></td>
    </tr>
  <% end %>
</table>
